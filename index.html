<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>Taux BEAC - Tableau des taux</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="p-4">
    <div class="container">
        <h1 class="mb-4">Taux indicatifs de change BEAC</h1>
        <button id="btnScrape" class="btn btn-primary mb-3">Récupérer les taux</button>
        <div id="result" class="mt-3"></div>
    </div>

    <script>
        document.getElementById('btnScrape').addEventListener('click', async () => {
            const btn = document.getElementById('btnScrape');
            const resultDiv = document.getElementById('result');
            btn.disabled = true;
            btn.textContent = 'Chargement...';
            resultDiv.innerHTML = '';

            try {
                const response = await fetch('http://127.0.0.1:8000/scrape');
                if (!response.ok) throw new Error('Erreur HTTP ' + response.status);
                const data = await response.json();

                if (data.detail) {
                    resultDiv.innerHTML = `<div class="alert alert-danger">${data.detail}</div>`;
                } else {
                    let html = `<h5>Date de valeur : ${data.date_valeur}</h5>`;
                    html += `<table class="table table-striped table-bordered">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Paire de devises</th>
                                        <th>Achat</th>
                                        <th>Vente</th>
                                    </tr>
                                </thead>
                                <tbody>`;
                    data.taux.forEach(t => {
                        html += `<tr>
                                    <td>${t.paire}</td>
                                    <td>${t.achat.toFixed(6)}</td>
                                    <td>${t.vente.toFixed(6)}</td>
                                </tr>`;
                    });
                    html += `</tbody></table>`;
                    resultDiv.innerHTML = html;
                }
            } catch (err) {
                resultDiv.innerHTML = `<div class="alert alert-danger">Erreur : ${err.message}</div>`;
            }

            btn.disabled = false;
            btn.textContent = 'Récupérer les taux';
        });
    </script>
</body>
</html>
